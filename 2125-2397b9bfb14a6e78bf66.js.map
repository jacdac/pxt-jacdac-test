{"version":3,"file":"2125-2397b9bfb14a6e78bf66.js","mappings":"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","sources":["webpack://jacdac-docs/./node_modules/@mui/icons-material/PowerSettingsNew.js","webpack://jacdac-docs/./node_modules/@mui/icons-material/Send.js","webpack://jacdac-docs/./src/components/dashboard/DashboardBitRadio.tsx"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M13 3h-2v10h2V3zm4.83 2.17-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z\"\n}), 'PowerSettingsNew');\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z\"\n}), 'Send');\nexports.default = _default;","import React, { ChangeEvent, useEffect, useId, useState } from \"react\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport {\n    BitRadioCmd,\n    BitRadioReg,\n} from \"../../../jacdac-ts/jacdac-spec/dist/specconstants\"\nimport { REPORT_RECEIVE } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { jdunpack, PackedValues } from \"../../../jacdac-ts/src/jdom/pack\"\nimport { Packet } from \"../../../jacdac-ts/src/jdom/packet\"\nimport { Grid, TextField } from \"@mui/material\"\nimport PowerSettingsNewIcon from \"@mui/icons-material/PowerSettingsNew\"\nimport DashboardRegisterValueFallback from \"./DashboardRegisterValueFallback\"\nimport { useRegisterBoolValue } from \"../../jacdac/useRegisterValue\"\nimport useRegister from \"../hooks/useRegister\"\nimport CmdButton from \"../CmdButton\"\nimport RegisterInput from \"../RegisterInput\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\nimport SendIcon from \"@mui/icons-material/Send\"\n\nconst HORIZON = 10\n\ninterface RadioMessageProps {\n    time: number\n    deviceSerial: number\n    rssi: number\n    payload: PackedValues\n}\n\nfunction RadioGroupSettings(props: { service: JDService; visible: boolean }) {\n    const { service, visible } = props\n    const register = useRegister(service, BitRadioReg.Group)\n    return (\n        <Grid item xs={12}>\n            <RegisterInput register={register} visible={visible} />\n        </Grid>\n    )\n}\n\nfunction RadioTransmisionPowerSettings(props: {\n    service: JDService\n    visible: boolean\n}) {\n    const { service, visible } = props\n    const register = useRegister(service, BitRadioReg.TransmissionPower)\n    return (\n        <Grid item xs={12}>\n            <RegisterInput\n                register={register}\n                visible={visible}\n                showRegisterName={true}\n            />\n        </Grid>\n    )\n}\n\nfunction RadioMessageEditorItem(props: DashboardServiceProps) {\n    const { service } = props\n    const id = useId()\n    const valueId = \"value\" + id\n    const [value, setValue] = useState(\"\")\n    const enabledRegister = useRegister(service, BitRadioReg.Enabled)\n    const enabled = useRegisterBoolValue(enabledRegister, props)\n\n    const handleValueChange = (ev: ChangeEvent<HTMLInputElement>) =>\n        setValue(ev.target.value.trim())\n    const handleSend = async () => {\n        const n = parseInt(value) ?? parseFloat(value)\n        if (!isNaN(n))\n            await service.sendCmdPackedAsync(BitRadioCmd.SendNumber, [n], true)\n        else\n            await service.sendCmdPackedAsync(\n                BitRadioCmd.SendString,\n                [value],\n                true\n            )\n    }\n\n    const handleEnabled = async () =>\n        await enabledRegister.sendSetBoolAsync(!enabled, true)\n\n    if (enabled === undefined)\n        return <DashboardRegisterValueFallback register={enabledRegister} />\n\n    return (\n        <Grid container direction=\"row\" spacing={1}>\n            <Grid item>\n                <CmdButton\n                    title={enabled ? \"disable radio\" : \"enable radio\"}\n                    onClick={handleEnabled}\n                    color={enabled ? \"primary\" : undefined}\n                    icon={<PowerSettingsNewIcon />}\n                />\n            </Grid>\n            <Grid item>\n                <TextField\n                    size=\"small\"\n                    type=\"number\"\n                    id={valueId}\n                    label=\"Message\"\n                    helperText=\"Number will be encoded as a number message.\"\n                    value={value}\n                    onChange={handleValueChange}\n                />\n            </Grid>\n            <Grid item>\n                <CmdButton\n                    title=\"send message\"\n                    disabled={!enabled}\n                    onClick={handleSend}\n                >\n                    <SendIcon />\n                </CmdButton>\n            </Grid>\n        </Grid>\n    )\n}\n\nexport default function DashboardBitRadio(props: DashboardServiceProps) {\n    const { service, expanded } = props\n    const [lastEvents, setLastEvents] = useState<RadioMessageProps[]>([])\n\n    const appendMessage = (data: PackedValues) => {\n        if (!data) return\n\n        const [time, deviceSerial, rssi, ...payload] = data\n        setLastEvents(lastEvents => {\n            const evs = lastEvents.slice(0)\n            const msg = { time, deviceSerial, rssi, payload }\n            evs.push(msg)\n            while (evs.length > HORIZON) evs.shift()\n            return lastEvents\n        })\n    }\n\n    useEffect(\n        () =>\n            service.subscribe(REPORT_RECEIVE, (pkt: Packet) => {\n                let values: PackedValues\n                const { data, serviceCommand } = pkt\n                switch (serviceCommand) {\n                    case BitRadioCmd.NumberReceived:\n                        values = jdunpack(data, \"u32 u32 i8 x[3] f64 s\")\n                        break\n                    case BitRadioCmd.StringReceived:\n                        values = jdunpack(data, \"u32 u32 i8 x[1] s\")\n                        break\n                    case BitRadioCmd.BufferReceived:\n                        values = jdunpack(data, \"u32 u32 i8 x[1] b\")\n                        break\n                }\n                if (values)\n                    appendMessage(\n                        values.filter(v => v !== undefined && v !== \"\")\n                    )\n            }),\n        [service, lastEvents]\n    )\n\n    const text = lastEvents\n        .map(ev =>\n            ev.payload?.filter(v => v !== undefined && v !== \"\").join(\",\")\n        )\n        .filter(el => !!el)\n        .join(\"\\n\")\n\n    return (\n        <Grid container spacing={1}>\n            <Grid item xs={12}>\n                <pre>{text || \"no radio messages\"}</pre>\n            </Grid>\n            <Grid item xs={12}>\n                <RadioMessageEditorItem {...props} />\n            </Grid>\n            {expanded && (\n                <RadioGroupSettings service={service} visible={expanded} />\n            )}\n            {expanded && (\n                <RadioTransmisionPowerSettings\n                    service={service}\n                    visible={expanded}\n                />\n            )}\n        </Grid>\n    )\n}\n"],"names":["HORIZON","register","useRegister","BitRadioReg","id","useId","valueId","useState","enabledRegister","enabled","useRegisterBoolValue","handleValueChange","ev","setValue","handleSend","n","parseInt","parseFloat","isNaN","service","BitRadioCmd","handleEnabled","appendMessage","data","setLastEvents","lastEvents","evs","msg","useEffect","pkt","values","jdunpack","v","text","el","expanded"],"sourceRoot":""}